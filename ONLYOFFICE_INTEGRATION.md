# üöÄ OnlyOffice + Fallback Integration - –ó–ê–í–ï–†–®–ï–ù–û

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –∏–º–ø–æ—Ä—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### üéØ –ü—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:

1. **‚úÖ –£–±—Ä–∞–Ω "–±–µ–ª—ã–π —ç–∫—Ä–∞–Ω"** - –≤—Å–µ –ø–∞—Ä—Å–µ—Ä—ã –≤ client-components —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ try/catch/finally
2. **‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç** - OnlyOffice Document Server + fallback –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
3. **‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π** - 100% —Ç–æ—á–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ OnlyOffice, fallback —á–µ—Ä–µ–∑ mammoth/pdfjs
4. **‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏** - —á–µ—Ç–∫–∏–µ loading/error/ready —Å–æ—Å—Ç–æ—è–Ω–∏—è

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è:

### OnlyOffice (–æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å)
- **Document Server** –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- **iframe API** –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
- **JWT —Ç–æ–∫–µ–Ω—ã** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **Webhook** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Fallback (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –ø—É—Ç—å)
- **DOCX**: mammoth.js ‚Üí HTML —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç–∏–ª–µ–π
- **PDF**: pdfjs-dist ‚Üí Canvas —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- **PPTX/XLSX**: —Ç—Ä–µ–±—É—é—Ç OnlyOffice (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:

```
src/
‚îú‚îÄ‚îÄ app/api/
‚îÇ   ‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upload/route.ts          # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [key]/route.ts           # –†–∞–∑–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ onlyoffice/
‚îÇ       ‚îú‚îÄ‚îÄ config/route.ts          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
‚îÇ       ‚îî‚îÄ‚îÄ webhook/route.ts         # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ editor/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OnlyOfficeEditor.tsx     # OnlyOffice —Ä–µ–¥–∞–∫—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FallbackDocx.tsx         # DOCX fallback
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FallbackPdf.tsx          # PDF fallback
‚îÇ   ‚îî‚îÄ‚îÄ import/
‚îÇ       ‚îî‚îÄ‚îÄ ImportDropzone.tsx       # –ù–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç
‚îî‚îÄ‚îÄ app/app/page.tsx                 # –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.local):
```bash
# OnlyOffice Document Server
ONLYOFFICE_URL=http://localhost:8082
ONLYOFFICE_JWT_SECRET=devsecret
PUBLIC_HOST_FOR_DS=http://host.docker.internal:3000

# File Storage
UPLOAD_DIR=/tmp/kelbetty_uploads
```

### 2. Docker —Å–µ—Ä–≤–∏—Å—ã:
```bash
# –ó–∞–ø—É—Å–∫ Document Server
docker compose up -d documentserver

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker ps | grep onlyoffice
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:
```bash
npm install mammoth pdfjs-dist jsonwebtoken @types/jsonwebtoken
```

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞:
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Document Server
docker compose up -d documentserver

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm run dev

# 3. –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000/app
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞:

1. **OnlyOffice –ø—É—Ç—å** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π):
   - –ó–∞–≥—Ä—É–∑–∏—Ç–µ DOCX/PPTX/XLSX/PDF
   - –û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —ç–∫—Å–ø–æ—Ä—Ç

2. **Fallback –ø—É—Ç—å** (–µ—Å–ª–∏ Document Server –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω):
   - DOCX: mammoth.js ‚Üí HTML —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - PDF: pdfjs-dist ‚Üí Canvas –ø—Ä–æ—Å–º–æ—Ç—Ä
   - PPTX/XLSX: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ OnlyOffice

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

### ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- **–î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞**: OnlyOffice + fallback
- **–ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π**: —á–µ—Ç–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ
- **100% —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π** —á–µ—Ä–µ–∑ OnlyOffice
- **–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **–≠–∫—Å–ø–æ—Ä—Ç –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö**

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **Client-side —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥** - –Ω–µ—Ç SSR –ø—Ä–æ–±–ª–µ–º
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** - –±—ã—Å—Ç—Ä–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

## üîç –û—Ç–ª–∞–¥–∫–∞:

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Document Server:
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps | grep onlyoffice

# –õ–æ–≥–∏
docker logs onlyoffice

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl http://localhost:8082/healthcheck
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤:
```bash
# –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
ls -la /tmp/kelbetty_uploads/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl http://localhost:3000/api/storage/upload
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:

- **‚úÖ –°–±–æ—Ä–∫–∞**: –£—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
- **‚úÖ –¢–∏–ø—ã**: –í—Å–µ TypeScript –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- **‚úÖ –ò–º–ø–æ—Ä—Ç**: DOCX/PDF —Ä–∞–±–æ—Ç–∞—é—Ç –≤ fallback —Ä–µ–∂–∏–º–µ
- **‚úÖ OnlyOffice**: –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Document Server
- **‚úÖ UI/UX**: –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—à–∏–±–æ–∫

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–º–æ!

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞–º —Å –Ω–æ–≤—ã–º –Ω–∞–¥–µ–∂–Ω—ã–º –º–µ—Ç–æ–¥–æ–º –∏–º–ø–æ—Ä—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤!
